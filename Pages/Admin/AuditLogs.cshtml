@page
@model LendSecure.Pages.Admin.AuditLogsModel
@{
    ViewData["Title"] = "Audit Logs";
}

<link rel="stylesheet" href="~/css/admin-audit-logs.css" asp-append-version="true" />

<div class="audit-logs-container">
    <!-- Page Header -->
    <div class="page-header-row">
        <div class="header-title">
            <i class="bi bi-receipt"></i>
            <h2>System Audit Logs</h2>
        </div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/Admin/Dashboard">Dashboard</a></li>
                <li class="breadcrumb-item active">Audit Logs</li>
            </ol>
        </nav>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-label">Total Actions</span>
            <div class="stat-value">@Model.TotalLogs</div>
        </div>
        <div class="stat-card">
            <span class="stat-label">Today's Actions</span>
            <div class="stat-value">@Model.TodayLogs</div>
        </div>
        <div class="stat-card">
            <span class="stat-label">Unique Users</span>
            <div class="stat-value">@Model.UniqueUsers</div>
        </div>
        <div class="stat-card">
            <span class="stat-label">Last Hour</span>
            <div class="stat-value">@Model.LastHourLogs</div>
        </div>
    </div>

    <!-- Filter Form -->
    <div class="filter-card">
        <form method="get" class="filter-form">
            <div class="filter-group">
                <label class="filter-label">Action Type</label>
                <select name="actionFilter" class="form-select">
                    <option value="">All Actions</option>
                    <option value="Login" selected="@(Model.ActionFilter == "Login")">User Login</option>
                    <option value="Registration" selected="@(Model.ActionFilter == "Registration")">User Registration</option>
                    <option value="KYC" selected="@(Model.ActionFilter == "KYC")">KYC Actions</option>
                    <option value="Loan" selected="@(Model.ActionFilter == "Loan")">Loan Actions</option>
                    <option value="Wallet" selected="@(Model.ActionFilter == "Wallet")">Wallet Actions</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Date Range</label>
                <select name="dateFilter" class="form-select">
                    <option value="today" selected="@(Model.DateFilter == "today")">Today</option>
                    <option value="week" selected="@(Model.DateFilter == "week")">Last 7 Days</option>
                    <option value="month" selected="@(Model.DateFilter == "month")">Last 30 Days</option>
                    <option value="all" selected="@(Model.DateFilter == "all")">All Time</option>
                </select>
            </div>
            <div class="filter-group" style="flex: 0 0 200px;">
                <button type="submit" class="btn-apply">Apply Filters</button>
            </div>
        </form>
    </div>

    <!-- Audit Logs Table -->
    <div class="table-card">
        <div class="table-header">
            <h5 class="table-title">Audit Trail (@Model.Logs.Count records)</h5>
        </div>
        @if (Model.Logs.Any())
        {
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>User</th>
                            <th>Action</th>
                            <th>Details</th>
                            <th>IP Address</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var log in Model.Logs)
                        {
                            <tr>
                                <td>@log.CreatedAt.ToString("MMM dd, HH:mm:ss")</td>
                                <td>@log.User.Email</td>
                                <td>
                                    @if (log.Action.Contains("Login"))
                                    {
                                        <span class="badge-action badge-login">@log.Action</span>
                                    }
                                    else if (log.Action.Contains("KYC"))
                                    {
                                        <span class="badge-action badge-kyc">@log.Action</span>
                                    }
                                    else if (log.Action.Contains("Loan"))
                                    {
                                        <span class="badge-action badge-loan">@log.Action</span>
                                    }
                                    else if (log.Action.Contains("Wallet"))
                                    {
                                        <span class="badge-action badge-wallet">@log.Action</span>
                                    }
                                    else if (log.Action.Contains("Registration"))
                                    {
                                        <span class="badge-action badge-registration">@log.Action</span>
                                    }
                                    else
                                    {
                                        <span class="badge-action">@log.Action</span>
                                    }
                                </td>
                                <td>@log.Details</td>
                                <td class="ip-address">@log.IpAddress</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="empty-state">
                <p class="mb-0">No audit logs found for the selected filters.</p>
            </div>
        }
    </div>
</div>